var g=Object.defineProperty;var p=(s,e,t)=>e in s?g(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>(p(s,typeof e!="symbol"?e+"":e,t),t);import{B as y,l as h,P as D,N as n}from"./BaseDemo-21616005.js";import{m as _,a as f,b as u}from"./mecha_1406_tex-2bd5e653.js";import{D as d}from"./DragHelper-a1f09b7f.js";const m=""+new URL("floor_board_ske-de3cab10.json",import.meta.url).href,c=""+new URL("floor_board_tex-06469d72.json",import.meta.url).href,B=""+new URL("floor_board_tex-44a54ee0.png",import.meta.url).href;class w extends y{constructor(){super();o(this,"_faceDir",0);o(this,"_aimRadian",0);o(this,"_offsetRotation",0);o(this,"_target",new h.Point);o(this,"_armatureDisplay",null);o(this,"_floorBoard",null);o(this,"_chestBone",null);o(this,"_leftFootBone",null);o(this,"_rightFootBone",null);o(this,"_circleBone",null);o(this,"_floorBoardBone",null);o(this,"_aimState",null);this._resources.push(_,f,u,m,c,B)}_onStart(){var r;this.interactive=!0;const t=l=>{this._target.x=l.data.global.x-this.x,this._target.y=l.data.global.y-this.y};this.addListener("touchmove",t,this),this.addListener("mousemove",t,this),h.ticker.shared.add(this._enterFrameHandler,this);const i=D.factory;if(i.parseDragonBonesData(this._pixiResources[_].data),i.parseTextureAtlasData(this._pixiResources[f].data,this._pixiResources[u].texture),i.parseDragonBonesData(this._pixiResources[m].data),i.parseTextureAtlasData(this._pixiResources[c].data,this._pixiResources[B].texture),this._armatureDisplay=i.buildArmatureDisplay("mecha_1406"),this._floorBoard=i.buildArmatureDisplay("floor_board"),this._armatureDisplay===null)throw new Error("this._armatureDisplay is null.");if(this._floorBoard===null)throw new Error("this._floorBoard is null.");if(this._chestBone=this._armatureDisplay.armature.getBone("chest"),this._leftFootBone=this._armatureDisplay.armature.getBone("foot_l"),this._rightFootBone=this._armatureDisplay.armature.getBone("foot_r"),this._circleBone=this._floorBoard.armature.getBone("circle"),this._floorBoardBone=this._floorBoard.armature.getBone("floor_board"),this._armatureDisplay.animation.play("idle"),this._aimState=this._armatureDisplay.animation.fadeIn("aim",.1,1,0,"aim_group"),this._aimState===null)throw new Error("this._aimState is null.");this._aimState.resetToPose=!1,this._aimState.stop(),this._floorBoard.animation.play("idle");const a=this._floorBoard.armature.getSlot("player");if(a===null)throw new Error("slot is null.");a.display=this._armatureDisplay,this._floorBoard.x=0,this._floorBoard.y=50,this.addChild(this._floorBoard),d.getInstance().stage=this,d.getInstance().enableDrag((r=this._floorBoard.armature.getSlot("circle"))==null?void 0:r.display),this.createText("Touch to drag circle to modify IK bones.")}_enterFrameHandler(t){this._updateAim(),this._updateFoot()}_updateAim(){if(this._floorBoard===null)throw new Error("this._floorBoard is null.");if(this._chestBone===null)throw new Error("this._chestBone is null.");const t=this._floorBoard.x,i=this._floorBoard.y,a=this._chestBone.global.y*this._floorBoard.scale.y;if(this._faceDir=this._target.x>0?1:-1,this._armatureDisplay===null)throw new Error("this._armatureDisplay is null.");this._armatureDisplay.armature.flipX=this._faceDir<0,this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-i-a,this._target.x-t):(this._aimRadian=Math.PI-Math.atan2(this._target.y-i-a,this._target.x-t),this._aimRadian>Math.PI&&(this._aimRadian-=Math.PI*2));const r=Math.abs((this._aimRadian+Math.PI/2)/Math.PI);if(this._aimState===null)throw new Error("this._aimState is null.");this._aimState.currentTime=r*this._aimState.totalTime}_updateFoot(){const t=-25*n.DEG_RAD,i=25*n.DEG_RAD;if(this._circleBone===null)throw new Error("this._circleBone is null.");let a=Math.atan2(this._circleBone.global.y,this._circleBone.global.x);if(this._circleBone.global.x<0&&(a=n.normalizeRadian(a+Math.PI)),this._offsetRotation=Math.min(Math.max(a,t),i),this._floorBoardBone===null)throw new Error("this._floorBoardBone is null.");this._floorBoardBone.offset.rotation=this._offsetRotation,this._floorBoardBone.invalidUpdate();const r=Math.tan(this._offsetRotation),l=1/Math.sin(Math.PI*.5-this._offsetRotation)-1;if(this._leftFootBone===null)throw new Error("this._leftFootBone is null.");if(this._leftFootBone.origin===null)throw new Error("this._leftFootBone.origin is null.");if(this._leftFootBone.offset.y=r*this._leftFootBone.global.x+this._leftFootBone.origin.y*l,this._leftFootBone.offset.rotation=this._offsetRotation*this._faceDir,this._leftFootBone.invalidUpdate(),this._rightFootBone===null)throw new Error("this._rightFootBone is null.");if(this._rightFootBone.origin===null)throw new Error("this._rightFootBone.origin is null.");this._rightFootBone.offset.y=r*this._rightFootBone.global.x+this._rightFootBone.origin.y*l,this._rightFootBone.offset.rotation=this._offsetRotation*this._faceDir,this._rightFootBone.invalidUpdate()}}new w;
