var P=Object.defineProperty;var T=(r,s,t)=>s in r?P(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var e=(r,s,t)=>(T(r,typeof s!="symbol"?s+"":s,t),t);import{B as D,l,P as E,w as u}from"./BaseDemo-21616005.js";import{m as x,a as c,b as w}from"./mecha_2903_tex-40bccf34.js";import{D as p}from"./DragHelper-a1f09b7f.js";const A=""+new URL("bounding_box_tester_ske-69a68325.json",import.meta.url).href,b=""+new URL("bounding_box_tester_tex-4bf0c50d.json",import.meta.url).href,y=""+new URL("bounding_box_tester_tex-7feae070.png",import.meta.url).href;class v extends D{constructor(){super();e(this,"_helpPointA",new l.Point);e(this,"_helpPointB",new l.Point);e(this,"_helpPointC",new l.Point);e(this,"_armatureDisplay",null);e(this,"_boundingBoxTester",null);e(this,"_targetA",null);e(this,"_targetB",null);e(this,"_line",null);e(this,"_pointA",null);e(this,"_pointB",null);this._resources.push(x,c,w,A,b,y)}_onStart(){var o,a;l.ticker.shared.add(this._enterFrameHandler,this);const t=E.factory;if(t.parseDragonBonesData(this._pixiResources[x].data),t.parseTextureAtlasData(this._pixiResources[c].data,this._pixiResources[w].texture),t.parseDragonBonesData(this._pixiResources[A].data),t.parseTextureAtlasData(this._pixiResources[b].data,this._pixiResources[y].texture),this._armatureDisplay=t.buildArmatureDisplay("mecha_2903d"),this._boundingBoxTester=t.buildArmatureDisplay("tester"),this._boundingBoxTester===null)throw new Error("this._boundingBoxTester is null.");if(this._targetA=(o=this._boundingBoxTester.armature.getSlot("target_a"))==null?void 0:o.display,this._targetB=(a=this._boundingBoxTester.armature.getSlot("target_b"))==null?void 0:a.display,this._line=this._boundingBoxTester.armature.getBone("line"),this._pointA=this._boundingBoxTester.armature.getBone("point_a"),this._pointB=this._boundingBoxTester.armature.getBone("point_b"),this._armatureDisplay===null)throw new Error("this._armatureDisplay is null.");if(this._targetA===null)throw new Error("this._targetA is null.");if(this._targetB===null)throw new Error("this._targetB is null.");if(this._line===null)throw new Error("this._line is null.");if(this._pointA===null)throw new Error("this._pointA is null.");if(this._pointB===null)throw new Error("this._pointB is null.");this._armatureDisplay.debugDraw=!0,this._armatureDisplay.x=0,this._armatureDisplay.y=100,this._boundingBoxTester.x=0,this._boundingBoxTester.y=200,this._targetA.armature.inheritAnimation=!1,this._targetB.armature.inheritAnimation=!1,this._line.offsetMode=u.Override,this._pointA.offsetMode=u.Override,this._pointB.offsetMode=u.Override,this._armatureDisplay.animation.play("walk"),this._boundingBoxTester.animation.play("0"),this.addChild(this._armatureDisplay),this.addChild(this._boundingBoxTester),this.interactive=!0,p.getInstance().stage=this,p.getInstance().enableDrag(this._targetA),p.getInstance().enableDrag(this._targetB),this.createText("Touch to drag bounding box tester.")}_enterFrameHandler(t){var d,f;if(this._targetA===null)throw new Error("this._targetA is null.");if(this._targetB===null)throw new Error("this._targetB is null.");if(this._armatureDisplay===null)throw new Error("this._armatureDisplay is null.");if(this._boundingBoxTester===null)throw new Error("this._boundingBoxTester is null.");this._helpPointA.set(this._targetA.x,this._targetA.y),this._helpPointB.set(this._targetB.x,this._targetB.y),this._armatureDisplay.toLocal(this._helpPointA,this._boundingBoxTester,this._helpPointA),this._armatureDisplay.toLocal(this._helpPointB,this._boundingBoxTester,this._helpPointB);const o=this._armatureDisplay.armature.containsPoint(this._helpPointA.x,this._helpPointA.y),a=this._armatureDisplay.armature.containsPoint(this._helpPointB.x,this._helpPointB.y),g=this._armatureDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y,this._helpPointB.x,this._helpPointB.y,this._helpPointA,this._helpPointB,this._helpPointC);{const i=o?"1":"0";if(this._targetA.animation.lastAnimationName!==i){const n=this._targetA.animation.fadeIn(i,.2);if(n===null)throw new Error("fade is null.");n.resetToPose=!1}}{const i=a?"1":"0";if(this._targetB.animation.lastAnimationName!==i){const n=this._targetB.animation.fadeIn(i,.2);if(n===null)throw new Error("fade is null.");n.resetToPose=!1}}{const i=((d=this._targetA.armature.parent)==null?void 0:d.parent)??null,n=((f=this._targetB.armature.parent)==null?void 0:f.parent)??null;if(n===null)throw new Error("targetB is null.");if(i===null)throw new Error("targetA is null.");const h=n.global.x-i.global.x,_=n.global.y-i.global.y;if(this._line===null)throw new Error("this._line is null.");this._line.offset.x=i.global.x,this._line.offset.y=i.global.y,this._line.offset.scaleX=Math.sqrt(h*h+_*_)/100,this._line.offset.rotation=Math.atan2(_,h),this._line.invalidUpdate();const m=g?"1":"0";if(this._boundingBoxTester.animation.lastAnimationName!==m){const B=this._boundingBoxTester.animation.fadeIn(m,.2);if(B===null)throw new Error("fade is null.");B.resetToPose=!1}if(g){if(this._boundingBoxTester.toLocal(this._helpPointA,this._armatureDisplay,this._helpPointA),this._boundingBoxTester.toLocal(this._helpPointB,this._armatureDisplay,this._helpPointB),this._pointA===null)throw new Error("this._pointA is null.");if(this._pointB===null)throw new Error("this._pointB is null.");this._pointA.visible=!0,this._pointB.visible=!0,this._pointA.offset.x=this._helpPointA.x,this._pointA.offset.y=this._helpPointA.y,this._pointB.offset.x=this._helpPointB.x,this._pointB.offset.y=this._helpPointB.y,this._pointA.offset.rotation=this._helpPointC.x,this._pointB.offset.rotation=this._helpPointC.y,this._pointA.invalidUpdate(),this._pointB.invalidUpdate()}else{if(this._pointA===null)throw new Error("this._pointA is null.");if(this._pointB===null)throw new Error("this._pointB is null.");this._pointA.visible=!1,this._pointB.visible=!1}}}}new v;
